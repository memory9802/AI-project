## Context

團隊目前面臨多人協作開發時的環境一致性問題。每位組員因為本機環境差異（作業系統、Docker 版本、端口佔用等），需要修改核心配置檔案如 `docker-compose.yml` 來適應自己的環境。這種做法雖然能讓每個人順利開發，但帶來了以下風險：

1. **配置漂移**：核心架構被個人需求污染
2. **Git 衝突**：配置檔案的頻繁修改造成合併困難  
3. **部署不一致**：生產環境與開發環境差異過大
4. **新手困擾**：新加入的組員難以快速建立開發環境

## Goals / Non-Goals

**Goals:**
- 建立核心配置與個人配置的清晰邊界
- 確保底層架構（Docker services、資料庫結構）在所有環境中一致
- 提供靈活的個人環境適配機制
- 簡化新組員的環境設置流程
- 防止敏感資訊（API keys）意外提交到版本控制

**Non-Goals:**  
- 不強制所有組員使用完全相同的開發工具
- 不限制組員使用自己偏好的 IDE 或編輯器設定
- 不解決網路環境差異（如公司防火牆、代理設定）

## Decisions

### Decision 1: 採用 Docker Compose Override 機制
**理由**：Docker Compose 原生支援 `docker-compose.override.yml` 來覆蓋基礎配置，這是官方推薦的最佳實踐。

**實施方式**：
- `docker-compose.yml` 作為團隊標準，包含所有服務定義
- `docker-compose.override.yml` 用於個人環境適配（端口映射、資料卷路徑等）
- `docker-compose.override.yml.example` 提供常見適配範本

### Decision 2: 三層環境變數管理
**理由**：不同層級的環境變數有不同的管理需求。

**結構設計**：
1. **預設值層**：寫在應用程式碼中的預設配置
2. **團隊共用層**：`.env.example` 定義標準環境變數結構  
3. **個人機密層**：`.env` 包含實際的 API keys 和個人設定

### Decision 3: VS Code 設定部分同步
**理由**：統一基礎開發體驗，但保留個人化空間。

**同步範圍**：
- 程式碼格式化設定（Python PEP 8、JavaScript Standard）
- 除錯配置和常用任務
- 建議安裝的擴充套件清單
- **不同步**：個人偏好的主題、字型、快捷鍵

**Alternatives considered:**
- **選項 A**：每個人維護自己的 docker-compose.yml 副本
  - ❌ 問題：無法確保架構一致性，難以同步更新
- **選項 B**：使用環境變數控制所有配置差異  
  - ❌ 問題：會讓 docker-compose.yml 變得過度複雜
- **選項 C**：強制所有人使用完全相同的環境
  - ❌ 問題：不現實，限制開發者的靈活性

## Risks / Trade-offs

### Risk 1: 學習成本增加
**影響**：組員需要學習 Docker Compose Override 機制
**緩解措施**：
- 提供詳細的設置指南和常見問題解答
- 建立環境檢查腳本，自動診斷配置問題
- 在團隊會議中進行操作示範

### Risk 2: 配置複雜度增加
**影響**：從單一檔案變成多檔案配置管理
**緩解措施**：
- 預設配置能覆蓋 80% 的使用情境
- 提供常見適配情境的範本
- 腳本化環境驗證流程

### Trade-off: 靈活性 vs 一致性
我們選擇在核心架構上保持嚴格一致性，在個人環境適配上提供充分靈活性。

## Migration Plan

### Phase 1: 基礎架構建立（第一週）
1. 建立配置分離架構
2. 更新文檔和 .gitignore
3. 在測試環境驗證新配置

### Phase 2: 團隊逐步遷移（第二週）  
1. 與每位組員個別協助環境遷移
2. 收集回饋並調整配置範本
3. 建立問題回報和解決流程

### Phase 3: 標準化執行（第三週）
1. 所有新的開發工作採用新配置
2. 建立定期的環境一致性檢查
3. 持續優化和更新文檔

**Rollback Plan:**
如果新配置造成重大開發阻礙，可以暫時回復到當前的"允許修改核心檔案"模式，但需要：
1. 記錄回退的具體原因
2. 制定改進計劃
3. 設定重新嘗試的時間點

## Open Questions

1. **端口衝突處理**：如何優雅處理多個專案同時開發時的端口衝突？
2. **資料持久化**：個人開發資料（如測試資料庫內容）是否需要在團隊間共享？
3. **CI/CD 整合**：新的配置架構如何與未來的自動化部署流程整合？
4. **效能考量**：Docker Compose Override 是否會影響容器啟動效能？