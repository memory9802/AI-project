<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Outfit AI ç©¿æ­æ¨è–¦</title>
  <style>
    /* ==========================================
       ğŸ¨ Jinja Test åˆ†æ”¯å„ªåŒ–ç‰ˆæœ¬
       
       ä¸»è¦æ”¹é€²ï¼š
       1. æ–°å¢è¼‰å…¥å‹•ç•« (Loading Spinner)
       2. æ–°å¢éŒ¯èª¤æç¤ºæ¨£å¼ (Error Messages)
       3. å„ªåŒ–æŒ‰éˆ•ç‹€æ…‹ (Button States)
       4. æ”¹å–„ä½¿ç”¨è€…é«”é©— (UX Improvements)
       ========================================== */
    body {
      font-family: "Segoe UI", "Noto Sans TC", sans-serif;
      background-color: #f4f4f9;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.08);
      padding: 24px;
    }
    h1 {
      margin-top: 0;
      margin-bottom: 8px;
    }
    .subtitle {
      margin-top: 0;
      margin-bottom: 20px;
      color: #555;
      font-size: 14px;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }
    label {
      font-weight: 600;
      font-size: 14px;
    }
    textarea {
      width: 100%;
      min-height: 80px;
      padding: 10px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
      resize: vertical;
      box-sizing: border-box;
    }
    select, button {
      padding: 10px 14px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ddd;
      box-sizing: border-box;
    }
    button {
      background-color: #4285f4;
      color: #fff;
      border: none;
      cursor: pointer;
      font-weight: 600;
      position: relative;
    }
    button:hover {
      background-color: #3367d6;
    }
    /* ğŸ†• å„ªåŒ–ï¼šæ–°å¢æŒ‰éˆ•ç¦ç”¨ç‹€æ…‹ï¼Œé˜²æ­¢é‡è¤‡æäº¤ */
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    /* ğŸ†• å„ªåŒ–ï¼šè¼‰å…¥å‹•ç•«æ¨£å¼ - æå‡ä½¿ç”¨è€…é«”é©— */
    .loading-spinner {
      display: none;
      text-align: center;
      padding: 20px;
      color: #4285f4;
    }
    .loading-spinner.active {
      display: block;
    }
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #4285f4;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 12px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* éŒ¯èª¤æç¤º */
    .error-message {
      background-color: #fee;
      border: 1px solid #fcc;
      color: #c33;  /* æ·±ç´…è‰²æ–‡å­— */
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .error-message strong {
      display: block;
      margin-bottom: 4px;
    }
    
    /* ğŸ†• å„ªåŒ–ï¼šæˆåŠŸæç¤ºæ¨£å¼ - è¦–è¦ºåŒ–å›é¥‹ */
    .success-message {
      background-color: #efe;  /* æ·¡ç¶ è‰²èƒŒæ™¯ */
      border: 1px solid #cfc;
      color: #363;  /* æ·±ç¶ è‰²æ–‡å­— */
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .section {
      margin-bottom: 24px;
    }
    .section h2 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 18px;
    }
    .keywords {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .keyword-tag {
      padding: 4px 10px;
      border-radius: 999px;
      background-color: #e9f0ff;
      font-size: 13px;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      background: #f7f7f9;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      margin: 0;
    }
    .outfit-card {
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 12px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }
    .outfit-image {
      width: 120px;
      min-width: 120px;
      height: 120px;
      border-radius: 8px;
      object-fit: cover;
      background-color: #f4f4f4;
      display: block;
    }
    .outfit-image-placeholder {
      width: 120px;
      min-width: 120px;
      height: 120px;
      border-radius: 8px;
      background: repeating-linear-gradient(
        45deg,
        #f4f4f4,
        #f4f4f4 10px,
        #e4e4e4 10px,
        #e4e4e4 20px
      );
    }
    .outfit-info h3 {
      margin: 0 0 4px 0;
      font-size: 16px;
    }
    .outfit-meta {
      margin: 0 0 8px 0;
      font-size: 13px;
      color: #777;
    }
    .outfit-desc {
      margin: 0 0 6px 0;
      font-size: 14px;
    }
    .items-list {
      margin-top: 4px;
      padding-left: 18px;
      font-size: 14px;
    }
    .items-list li {
      margin-bottom: 2px;
    }
    .empty-tip {
      font-size: 14px;
      color: #777;
    }

    /* åœ¨å°è¦–çª— / iframe è£¡ä¹Ÿèƒ½å¥½çœ‹ä¸€é» */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      .container {
        padding: 16px;
      }
      .outfit-card {
        flex-direction: column;
        align-items: stretch;
      }
      .outfit-image,
      .outfit-image-placeholder {
        width: 100%;
        height: 180px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ‘— Outfit AI ç©¿æ­æ¨è–¦</h1>
    <p class="subtitle">
      è«‹æè¿°ä½ çš„ç©¿æ­éœ€æ±‚ï¼Œä¾‹å¦‚ï¼šã€Œä»Šå¤©è¦å»ç´„æœƒï¼Œä½†æœ‰é»å†·ã€ï¼Œæˆ–ã€Œæ˜å¤©è¦å»ä¸Šç­ç°¡å ±ã€ã€‚
    </p>

    <!-- ğŸ†• å„ªåŒ–ï¼šè¼‰å…¥æç¤ºå€å¡Š - æäº¤è¡¨å–®æ™‚é¡¯ç¤º -->
    <div id="loadingSpinner" class="loading-spinner">
      <div class="spinner"></div>
      <p>AI æ­£åœ¨æ€è€ƒä¸­ï¼Œè«‹ç¨å€™... â³</p>
    </div>

    <!-- ğŸ”¹ æŸ¥è©¢è¡¨å–®ï¼šPOST å›åˆ° /recommend_page -->
    <!-- ğŸ†• å„ªåŒ–ï¼šæ–°å¢ id å±¬æ€§ï¼Œæ–¹ä¾¿ JavaScript æ§åˆ¶ -->
    <form id="recommendForm" method="POST">
      <div>
        <label for="message">ä½ çš„éœ€æ±‚ï¼š</label>
        <textarea
          id="message"
          name="message"
          placeholder="è¼¸å…¥ä½ ä»Šå¤©çš„å ´åˆã€é¢¨æ ¼æˆ–å¤©æ°£æè¿°..."
          required
        >{{ user_input or '' }}</textarea>
        <!-- ğŸ†• å„ªåŒ–ï¼šæ–°å¢ required å±¬æ€§ï¼Œç¢ºä¿ä½¿ç”¨è€…è¼¸å…¥å…§å®¹ -->
      </div>

      <div>
        <label for="model">é¸æ“‡æ¨¡å‹ï¼ˆå¯é¸ï¼‰ï¼š</label>
        <select id="model" name="model">
          <option value="auto" {% if selected_model == 'auto' %}selected{% endif %}>è‡ªå‹•é¸æ“‡</option>
          <option value="gemini" {% if selected_model == 'gemini' %}selected{% endif %}>Gemini</option>
          <option value="groq" {% if selected_model == 'groq' %}selected{% endif %}>Groq</option>
          <option value="deepseek" {% if selected_model == 'deepseek' %}selected{% endif %}>DeepSeek</option>
        </select>
      </div>

      <!-- ğŸ†• å„ªåŒ–ï¼šæ–°å¢ id å±¬æ€§ï¼Œæ–¹ä¾¿æ§åˆ¶æŒ‰éˆ•ç‹€æ…‹ -->
      <button id="submitBtn" type="submit">é€å‡ºæŸ¥è©¢</button>
    </form>

    <!-- ğŸ” é—œéµå­—å€å¡Š -->
    {% if keywords %}
    <div class="section">
      <h2>ğŸ” åµæ¸¬åˆ°çš„é—œéµå­—</h2>
      <div class="keywords">
        {% for kw in keywords %}
        <span class="keyword-tag">{{ kw }}</span>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- ğŸ†• å„ªåŒ–ï¼šæ™ºèƒ½éŒ¯èª¤è¨Šæ¯é¡¯ç¤º -->
    <!-- æ ¹æ“šå›æ‡‰å…§å®¹åˆ¤æ–·æ˜¯å¦ç‚ºéŒ¯èª¤ï¼Œä¸¦ç”¨ç´…è‰²æ¡†é¡¯ç¤º -->
    {% if ai_response and (ai_response.startswith('âŒ') or 'éŒ¯èª¤' in ai_response or 'å¤±æ•—' in ai_response or 'ç„¡æ³•' in ai_response) %}
    <div class="error-message">
      <strong>âš ï¸ AI é€£ç·šå•é¡Œ</strong>
      {{ ai_response }}
    </div>
    {% endif %}

    <!-- ğŸ’¬ AI æ–‡å­—å›è¦† -->
    {% if ai_response and not (ai_response.startswith('âŒ') or 'éŒ¯èª¤' in ai_response or 'å¤±æ•—' in ai_response) %}
    <div class="section">
      <h2>ğŸ’¬ AI æ¨è–¦èªªæ˜</h2>
      <pre>{{ ai_response }}</pre>
    </div>
    {% elif user_input and not ai_response %}
    <!-- æœ‰è¼¸å…¥ä½†æ²’æœ‰å›è¦† -->
    <div class="error-message">
      <strong>âš ï¸ ç„¡æ³•å–å¾—å›æ‡‰</strong>
      ç³»çµ±è™•ç†æ™‚ç™¼ç”Ÿå•é¡Œï¼Œè«‹ç¨å¾Œå†è©¦æˆ–å˜—è©¦åˆ‡æ›æ¨¡å‹ã€‚
    </div>
    {% endif %}

    <!-- ğŸ§¥ æ¨è–¦ç©¿æ­ / æœå°‹çµæœ -->
    {% if outfits %}
    <div class="section">
      <h2>ğŸ§¥ æ¨è–¦ç©¿æ­çµ„åˆ</h2>

      {% for outfit in outfits %}
      <div class="outfit-card">
        <!-- ç©¿æ­åœ–ç‰‡ï¼šå¦‚æœ DB æœ‰ image_url å°±é¡¯ç¤ºï¼Œæ²’æœ‰å°±ç”¨ placeholder -->
        {% if outfit.image_url %}
          <img
            src="{{ outfit.image_url }}"
            alt="{{ outfit.name }}"
            class="outfit-image"
          />
        {% else %}
          <div class="outfit-image-placeholder"></div>
        {% endif %}

        <div class="outfit-info">
          <h3>{{ outfit.name }}</h3>

          {% if outfit.occasion %}
          <p class="outfit-meta">å ´åˆï¼š{{ outfit.occasion }}</p>
          {% endif %}

          {% if outfit.description %}
          <p class="outfit-desc">{{ outfit.description }}</p>
          {% endif %}

          {% if outfit['items'] %}
           <ul class="items-list">
            {% for item in outfit['items'] %}
            <li>
             {{ item.name }}
             {% if item.color %} - {{ item.color }}{% endif %}
             {% if item.category %}ï¼ˆ{{ item.category }}ï¼‰{% endif %}
            </li>
           {% endfor %}
          </ul>
{% endif %}

        </div>
      </div>
      {% endfor %}
    </div>
    {% elif ai_response %}
    <!-- æœ‰ AI å›è¦†ä½†æ²’æœ‰ outfitsï¼ˆç†è«–ä¸Šæ¯”è¼ƒå°‘ï¼‰ï¼Œä¹Ÿæç¤ºä¸€ä¸‹ -->
    <div class="section">
      <h2>ğŸ§¥ æ¨è–¦ç©¿æ­çµ„åˆ</h2>
      <p class="empty-tip">ç›®å‰æ²’æœ‰é¡å¤–çš„ç©¿æ­çµ„åˆå¯ä»¥é¡¯ç¤ºã€‚</p>
    </div>
    {% endif %}
  </div>

  <script>
    /* ==========================================
       ğŸ†• å„ªåŒ–ï¼šJavaScript äº’å‹•é‚è¼¯
       
       åŠŸèƒ½ï¼š
       1. è¡¨å–®æäº¤æ™‚é¡¯ç¤ºè¼‰å…¥å‹•ç•«
       2. é˜²æ­¢é‡è¤‡æäº¤
       3. è¼¸å…¥é©—è­‰
       4. è‡ªå‹•æ²å‹•
       ========================================== */
    
    // ğŸ†• å„ªåŒ–ï¼šè¡¨å–®æäº¤è™•ç†
    document.getElementById('recommendForm').addEventListener('submit', function(e) {
      const submitBtn = document.getElementById('submitBtn');
      const spinner = document.getElementById('loadingSpinner');
      const messageInput = document.getElementById('message');
      
      // ğŸ†• å„ªåŒ–ï¼šè¼¸å…¥é©—è­‰ - ç¢ºä¿ä½¿ç”¨è€…æœ‰è¼¸å…¥å…§å®¹
      if (!messageInput.value.trim()) {
        e.preventDefault();
        alert('è«‹è¼¸å…¥ä½ çš„ç©¿æ­éœ€æ±‚ï¼');
        return;
      }
      
      // ğŸ†• å„ªåŒ–ï¼šé¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      submitBtn.disabled = true;  // ç¦ç”¨æŒ‰éˆ•ï¼Œé˜²æ­¢é‡è¤‡æäº¤
      submitBtn.textContent = 'è™•ç†ä¸­...';  // æ”¹è®ŠæŒ‰éˆ•æ–‡å­—
      spinner.classList.add('active');  // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
      
      // ğŸ†• å„ªåŒ–ï¼šè‡ªå‹•æ²å‹•åˆ°è¼‰å…¥æç¤ºä½ç½®
      spinner.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    // ğŸ†• å„ªåŒ–ï¼šé é¢è¼‰å…¥å®Œæˆæ™‚é‡ç½®ç‹€æ…‹
    // é˜²æ­¢é‡æ–°æ•´ç†å¾Œè¼‰å…¥å‹•ç•«é‚„åœ¨é¡¯ç¤º
    window.addEventListener('load', function() {
      const spinner = document.getElementById('loadingSpinner');
      const submitBtn = document.getElementById('submitBtn');
      
      spinner.classList.remove('active');  // éš±è—è¼‰å…¥å‹•ç•«
      submitBtn.disabled = false;  // å•Ÿç”¨æŒ‰éˆ•
      submitBtn.textContent = 'é€å‡ºæŸ¥è©¢';  // é‡ç½®æŒ‰éˆ•æ–‡å­—
    });

    // ğŸ†• å„ªåŒ–ï¼šéŒ¯èª¤è¨Šæ¯è‡ªå‹•æ²å‹•
    // å¦‚æœæœ‰éŒ¯èª¤è¨Šæ¯ï¼Œè‡ªå‹•æ²å‹•åˆ°éŒ¯èª¤ä½ç½®è®“ä½¿ç”¨è€…çœ‹åˆ°
    window.addEventListener('load', function() {
      const errorMsg = document.querySelector('.error-message');
      if (errorMsg) {
        errorMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });
  </script>
</body>
</html>
